<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Economics</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ“˜</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script type="module">
      import { SpeechService } from './services/speechService.js';
      window.SpeechService = SpeechService;
    </script>
    <style>
        .flashcard-container { perspective: 1000px; width: 24rem; height: 11rem; }
        .flashcard-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06); border-radius: 0.5rem; border: 1px solid #fcd34d; background-color: #fffbeb; display: flex; align-items: center; justify-content: center; font-size: 1.125rem; font-weight: 600; cursor: pointer; }
        .flashcard-container.is-flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; padding: 1rem; box-sizing: border-box; }
        .flashcard-front { background-color: #fffbeb; color: #333; border-radius: 0.5rem; }
        .flashcard-back { background-color: #dbeafe; color: #333; transform: rotateY(180deg); border-radius: 0.5rem; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <header class="bg-blue-900 text-white py-6 px-8">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
                <h1 id="mainHeading" class="text-3xl font-bold mb-1">Economics</h1>
                <p id="unitSubheading" class="text-lg"></p>
            </div>
            <nav class="mt-4 md:mt-0 flex flex-wrap gap-6">
                <a href="index.html" class="text-white font-semibold hover:underline focus:outline-none">Home</a>
                <button id="searchNavBtn" class="text-white font-semibold hover:underline focus:outline-none">Search</button>
            </nav>
            <div id="searchModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
                <div class="bg-white rounded-lg shadow-lg p-8 max-w-lg w-full relative">
                    <button id="closeSearchModal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                    <h3 class="text-xl font-bold mb-4 text-blue-900">Search the Contents</h3>
                    <div class="mb-4 flex gap-2">
                        <input id="searchInput" type="text" class="border rounded px-3 py-2 w-full" placeholder="Type your question here..." style="color: black; background: #f9fafb;" />
                        <button id="audioInputBtn" class="px-3 py-2 bg-yellow-500 text-blue-900 rounded hover:bg-yellow-600" title="Ask by voice">ðŸŽ¤</button>
                        <button id="searchModalBtn" class="px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700">Search</button>
                    </div>
                    <div id="searchAnswer" class="text-gray-900 text-base"></div>
                </div>
            </div>
        </div>
    </header>
    <main class="p-8 max-w-3xl mx-auto bg-white shadow-lg mt-8 rounded-lg">
        <section class="mb-10">
            <h2 class="text-2xl font-bold mb-4">Chapter Summary: Neil & Kanishq's Exam Prep Dialog</h2>
            <div class="accordion-item bg-blue-50 rounded-lg p-4 mb-4 shadow">
                <button id="summaryAccordionBtn" class="accordion-header w-full text-left px-4 py-3 bg-blue-100 hover:bg-blue-200 font-semibold rounded-t focus:outline-none" aria-expanded="false">Summary Dialog (Show/Hide)</button>
                <div id="summaryAccordionContent" class="accordion-content px-4 py-3 bg-white border border-t-0 rounded-b hidden">
                    <div id="summaryDialogContent"></div>
                </div>
            </div>
        </section>
        <section class="mb-10">
            <h2 class="text-2xl font-bold mb-4">Mindmap (Drilldown)</h2>
            <div id="mindmap-content" class="bg-yellow-50 rounded-lg p-4 mb-4 shadow"></div>
        </section>
        <section class="mb-10">
            <h2 class="text-2xl font-bold mb-4">Flippable Flashcards</h2>
            <div class="flex items-center mb-2">
                <span id="flashcard-count" class="text-gray-600 text-sm"></span>
            </div>
            <div id="flashcards" class="flex flex-wrap gap-4 justify-center"></div>
            <div class="mt-4 flex gap-2">
                <button id="prevFlashcardBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Previous</button>
                <button id="nextFlashcardBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Next</button>
            </div>
        </section>
        <section class="mb-10">
            <h2 class="text-2xl font-bold mb-4">Exercises</h2>
            <div id="exercises" class="bg-indigo-50 rounded-lg p-4 shadow space-y-6"></div>
        </section>
        <section class="mb-10">
            <h2 class="text-2xl font-bold mb-4">Long Answer Questions</h2>
            <div class="bg-blue-50 rounded-lg p-4 mb-4 shadow">
                <div id="long-answer-content" class="mb-4"></div>
                <div class="flex gap-4">
                    <button id="playLongAnswerBtn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Play</button>
                    <button id="pauseLongAnswerBtn" class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600">Pause</button>
                    <button id="stopLongAnswerBtn" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Stop</button>
                </div>
            </div>
        </section>
        <section class="mb-10">
            <h2 class="text-2xl font-bold mb-4">Numerical Questions</h2>
            <div class="bg-yellow-50 rounded-lg p-4 mb-4 shadow">
                <div id="numerical-questions-content" class="mb-4"></div>
            </div>
        </section>
    </main>
    <footer class="bg-blue-900 text-white text-center py-4 mt-8 rounded-b-lg">
        &copy; 2025 GENZ Study Business | For Neil's Educational Needs
    </footer>
    <script>
      // --- Dynamic Metadata Integration ---
      fetch('chapter2.json')
        .then(response => response.json())
        .then(data => {
          if (data.metadata) {
            document.title = 'Economics';
            const mainHeading = document.getElementById('mainHeading');
            if (mainHeading) {
              mainHeading.textContent = 'Economics';
            }
            const unitSubheading = document.getElementById('unitSubheading');
            if (unitSubheading) {
              unitSubheading.textContent = data.metadata.chapterTitle;
            }
          }
        });
      // --- Content Rendering Logic ---
      let chapterData = null;
      let flashcards = [];
      let flashIndex = 0;
      document.addEventListener('DOMContentLoaded', function() {
        fetch('chapter2.json')
          .then(res => res.json())
          .then(data => {
            chapterData = Array.isArray(data.chapters) ? data.chapters[0] : null;
            if (!chapterData) return;
            // Render all sections
            renderSummaryDialog();
            renderMindmap();
            flashcards = chapterData.flashcards || [];
            renderFlashcard();
            renderExercises();
            renderLongAnswer();
            renderNumericalQuestions();
      // --- Chapter Summary Dialog Render Function ---
      function renderSummaryDialog() {
        const dialogDiv = document.getElementById('summaryDialogContent');
        if (!chapterData || !chapterData.summaryDialog || !Array.isArray(chapterData.summaryDialog)) {
          dialogDiv.innerHTML = '<em>No summary dialog available.</em>';
          return;
        }
        let html = '';
        chapterData.summaryDialog.forEach((line, idx) => {
          const speaker = line.speaker === 'Neil' ? '<span class="font-bold text-blue-700">Neil:</span>' : '<span class="font-bold text-green-700">Kanishq:</span>';
          html += `<div class="mb-3 flex items-start"><div class="mr-2">${speaker}</div><div>${line.text}</div></div>`;
        });
        dialogDiv.innerHTML = html;
      }
          });
        // Flashcard navigation
        document.getElementById('prevFlashcardBtn').onclick = prevFlashcard;
        document.getElementById('nextFlashcardBtn').onclick = nextFlashcard;
        // Long Answer audio controls
        document.getElementById('playLongAnswerBtn').onclick = playLongAnswer;
        document.getElementById('pauseLongAnswerBtn').onclick = pauseLongAnswer;
        document.getElementById('stopLongAnswerBtn').onclick = stopLongAnswer;
      });
      // --- Section Render Functions ---
      function renderFullStory() {
        const fullStoryDiv = document.getElementById('fullStoryContent');
        if (!chapterData || !chapterData.story || !chapterData.story[0] || !chapterData.story[0].storyParts) {
          fullStoryDiv.innerHTML = '<em>No anecdote available.</em>';
          return;
        }
        let html = '';
        chapterData.story[0].storyParts.forEach((part, idx) => {
          if (part.richHtml) {
            html += `<div class="mb-2">${part.richHtml}</div>`;
          } else {
            html += `<div class="mb-2"><span class="font-semibold">${part.speaker}:</span> ${part.text}</div>`;
          }
        });
        fullStoryDiv.innerHTML = html;
      }
      function renderMindmap() {
        const mindmapDiv = document.getElementById('mindmap-content');
        if (!chapterData || !chapterData.mindmap || !chapterData.mindmap.length) {
          mindmapDiv.innerHTML = '<em>No mindmap available.</em>';
          return;
        }
        mindmapDiv.innerHTML = '';
        chapterData.mindmap.forEach((root, idx) => {
          mindmapDiv.appendChild(createMindmapNode(root, 0, `root-${idx}`));
        });
      }
      function createMindmapNode(node, level, idPrefix) {
        const container = document.createElement('div');
        container.className = `mb-2 ml-${level * 4}`;
        const header = document.createElement('button');
        header.className = 'w-full text-left font-semibold py-2 px-3 rounded bg-yellow-100 hover:bg-yellow-200 border border-yellow-300';
        header.textContent = node.title || 'Untitled';
        header.setAttribute('aria-expanded', 'false');
        header.setAttribute('aria-controls', `${idPrefix}-body`);
        header.onclick = function() {
          body.classList.toggle('hidden');
          header.setAttribute('aria-expanded', body.classList.contains('hidden') ? 'false' : 'true');
        };
        container.appendChild(header);
        const body = document.createElement('div');
        body.className = 'hidden bg-white border border-yellow-200 rounded p-3 mt-1';
        body.id = `${idPrefix}-body`;
        if (node.definition) {
          body.innerHTML += `<div class="mb-2"><strong>Definition:</strong> ${node.definition}</div>`;
        }
        if (node.explanation) {
          body.innerHTML += `<div class="mb-2"><strong>Explanation:</strong> ${node.explanation}</div>`;
        }
        if (node.example) {
          body.innerHTML += `<div class="mb-2"><strong>Example:</strong> ${node.example}</div>`;
        }
        if (node.keyPoints && node.keyPoints.length) {
          body.innerHTML += `<div class="mb-2"><strong>Key Points:</strong><ul class="list-disc ml-6">${node.keyPoints.map(kp => `<li>${kp}</li>`).join('')}</ul></div>`;
        }
        if (node.otherInfo) {
          body.innerHTML += `<div class="mb-2"><strong>Other Info:</strong> ${node.otherInfo}</div>`;
        }
        if (node.points && node.points.length) {
          body.innerHTML += `<div class="mt-2"><strong>Sub-Points:</strong></div>`;
          node.points.forEach((subNode, subIdx) => {
            body.appendChild(createMindmapNode(subNode, level + 1, `${idPrefix}-sub${subIdx}`));
          });
        }
        container.appendChild(body);
        return container;
      }
      function renderFlashcard() {
        const fcDiv = document.getElementById('flashcards');
        fcDiv.innerHTML = '';
        if (!flashcards || !flashcards.length) return;
        const cardData = flashcards[flashIndex];
        const cardContainer = document.createElement('div');
        cardContainer.className = 'flashcard-container';
        const cardInner = document.createElement('div');
        cardInner.className = 'flashcard-inner';
        const cardFront = document.createElement('div');
        cardFront.className = 'flashcard-face flashcard-front flex items-center justify-center';
        cardFront.innerHTML = `<span>${cardData.front}</span>`;
        const cardBack = document.createElement('div');
        cardBack.className = 'flashcard-face flashcard-back flex items-center justify-center';
        cardBack.innerHTML = `<span>${cardData.back}</span>`;
        cardInner.appendChild(cardFront);
        cardInner.appendChild(cardBack);
        cardContainer.appendChild(cardInner);
        cardContainer.addEventListener('click', function() {
          this.classList.toggle('is-flipped');
        });
        fcDiv.appendChild(cardContainer);
        document.getElementById('flashcard-count').textContent = `Card ${flashIndex + 1} of ${flashcards.length}`;
      }
      function prevFlashcard() {
        flashIndex = (flashIndex - 1 + flashcards.length) % flashcards.length;
        renderFlashcard();
      }
      function nextFlashcard() {
        flashIndex = (flashIndex + 1) % flashcards.length;
        renderFlashcard();
      }
      function renderExercises() {
        const exercisesDiv = document.getElementById('exercises');
        if (!chapterData || !chapterData.exercises) {
          exercisesDiv.innerHTML = '<em>No exercises available.</em>';
          return;
        }
        let html = '';
        if (chapterData.exercises.mcq && chapterData.exercises.mcq.length > 0) {
          html += `<div class="accordion-item mb-4">
              <button id="mcqAccordionBtn" class="accordion-header w-full text-left px-4 py-3 bg-indigo-100 hover:bg-indigo-200 font-semibold rounded-t focus:outline-none">Multiple Choice Questions (Show/Hide)</button>
              <div id="mcqAccordionContent" class="accordion-content px-4 py-3 bg-white border border-t-0 rounded-b hidden">
                  ${chapterData.exercises.mcq.map((q, i) => `
                      <div class="mb-4 p-3 bg-white rounded shadow-sm">
                          <p class="font-medium mb-2">${i + 1}. ${q.question}</p>
                          <div class="space-y-1">
                              ${q.options.map((option, optIdx) => `<label class="block"><input type="radio" name="mcq${i}" value="${optIdx}" class="mr-2">${option}</label>`).join('')}
                          </div>
                          <div id="mcq-feedback-${i}" class="mt-2 text-sm font-semibold hidden"></div>
                      </div>
                  `).join('')}
                  <button id="checkMCQBtn" class="mt-2 px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">Check Answers</button>
              </div>
          </div>`;
        }
        if (chapterData.exercises.trueFalse && chapterData.exercises.trueFalse.length > 0) {
          html += `<div class="accordion-item mb-4">
              <button id="tfAccordionBtn" class="accordion-header w-full text-left px-4 py-3 bg-indigo-100 hover:bg-indigo-200 font-semibold rounded-t focus:outline-none">True/False Questions (Show/Hide)</button>
              <div id="tfAccordionContent" class="accordion-content px-4 py-3 bg-white border border-t-0 rounded-b hidden">
                  ${chapterData.exercises.trueFalse.map((q, i) => `
                      <div class="mb-4 p-3 bg-white rounded shadow-sm">
                          <p class="font-medium mb-2">${i + 1}. ${q.question}</p>
                          <div class="space-x-4">
                              <label class="inline-flex items-center"><input type="radio" name="tf${i}" value="true" class="mr-1"> True</label>
                              <label class="inline-flex items-center"><input type="radio" name="tf${i}" value="false" class="mr-1"> False</label>
                          </div>
                          <div id="tf-feedback-${i}" class="mt-2 text-sm font-semibold hidden"></div>
                      </div>
                  `).join('')}
                  <button id="checkTFBtn" class="mt-2 px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">Check Answers</button>
              </div>
          </div>`;
        }
        if (chapterData.exercises.oneWord && chapterData.exercises.oneWord.length > 0) {
          html += `<div class="accordion-item mb-4">
              <button id="oneWordAccordionBtn" class="accordion-header w-full text-left px-4 py-3 bg-indigo-100 hover:bg-indigo-200 font-semibold rounded-t focus:outline-none">One Word Answers (Show/Hide)</button>
              <div id="oneWordAccordionContent" class="accordion-content px-4 py-3 bg-white border border-t-0 rounded-b hidden">
                  ${chapterData.exercises.oneWord.map((q, i) => `
                      <div class="mb-4 p-3 bg-white rounded shadow-sm">
                          <p class="font-medium mb-2">${i + 1}. ${q.question}</p>
                          <input type="text" id="oneword${i}" class="border rounded px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Type your answer here">
                          <div id="oneword-feedback-${i}" class="mt-2 text-sm font-semibold hidden"></div>
                      </div>
                  `).join('')}
                  <button id="checkOneWordBtn" class="mt-2 px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">Check Answers</button>
              </div>
          </div>`;
        }
        if (chapterData.exercises.shortAnswer1 && chapterData.exercises.shortAnswer1.length > 0) {
          html += `<div class="accordion-item mb-4">
              <button id="short1AccordionBtn" class="accordion-header w-full text-left px-4 py-3 bg-indigo-100 hover:bg-indigo-200 font-semibold rounded-t focus:outline-none">Short Answer Questions (Type 1) (Show/Hide)</button>
              <div id="short1AccordionContent" class="accordion-content px-4 py-3 bg-white border border-t-0 rounded-b hidden">
                  ${chapterData.exercises.shortAnswer1.map((q, i) => `
                      <div class="mb-4 p-3 bg-white rounded shadow-sm">
                          <p class="font-medium mb-2">${i + 1}. ${q.question}</p>
                          <div class="bg-gray-50 border rounded px-3 py-2 mt-2"><strong>Answer:</strong> ${q.answer || ''}</div>
                      </div>
                  `).join('')}
              </div>
          </div>`;
        }
        if (chapterData.exercises.shortAnswer2 && chapterData.exercises.shortAnswer2.length > 0) {
          html += `<div class="accordion-item mb-4">
              <button id="short2AccordionBtn" class="accordion-header w-full text-left px-4 py-3 bg-indigo-100 hover:bg-indigo-200 font-semibold rounded-t focus:outline-none">Short Answer Questions (Type 2) (Show/Hide)</button>
              <div id="short2AccordionContent" class="accordion-content px-4 py-3 bg-white border border-t-0 rounded-b hidden">
                  ${chapterData.exercises.shortAnswer2.map((q, i) => `
                      <div class="mb-4 p-3 bg-white rounded shadow-sm">
                          <p class="font-medium mb-2">${i + 1}. ${q.question}</p>
                          <div class="bg-gray-50 border rounded px-3 py-2 mt-2"><strong>Answer:</strong> ${q.answer || ''}</div>
                      </div>
                  `).join('')}
              </div>
          </div>`;
        }
        exercisesDiv.innerHTML = html;
        // Accordion logic
        const mcqBtn = document.getElementById('mcqAccordionBtn');
        const mcqContent = document.getElementById('mcqAccordionContent');
        if (mcqBtn && mcqContent) { mcqBtn.onclick = () => mcqContent.classList.toggle('hidden'); }
        const tfBtn = document.getElementById('tfAccordionBtn');
        const tfContent = document.getElementById('tfAccordionContent');
        if (tfBtn && tfContent) { tfBtn.onclick = () => tfContent.classList.toggle('hidden'); }
        const short1Btn = document.getElementById('short1AccordionBtn');
        const short1Content = document.getElementById('short1AccordionContent');
        if (short1Btn && short1Content) { short1Btn.onclick = () => short1Content.classList.toggle('hidden'); }
        const short2Btn = document.getElementById('short2AccordionBtn');
        const short2Content = document.getElementById('short2AccordionContent');
        if (short2Btn && short2Content) { short2Btn.onclick = () => short2Content.classList.toggle('hidden'); }
        const oneWordBtn = document.getElementById('oneWordAccordionBtn');
        const oneWordContent = document.getElementById('oneWordAccordionContent');
        if (oneWordBtn && oneWordContent) { oneWordBtn.onclick = () => oneWordContent.classList.toggle('hidden'); }
        const checkMCQBtn = document.getElementById('checkMCQBtn');
        if (checkMCQBtn) checkMCQBtn.onclick = function() { checkAnswers('mcq'); };
        const checkTFBtn = document.getElementById('checkTFBtn');
        if (checkTFBtn) checkTFBtn.onclick = function() { checkAnswers('trueFalse'); };
        const checkShort1Btn = document.getElementById('checkShort1Btn');
        if (checkShort1Btn) checkShort1Btn.onclick = function() { checkAnswers('shortAnswer1'); };
        const checkShort2Btn = document.getElementById('checkShort2Btn');
        if (checkShort2Btn) checkShort2Btn.onclick = function() { checkAnswers('shortAnswer2'); };
        const checkOneWordBtn = document.getElementById('checkOneWordBtn');
        if (checkOneWordBtn) checkOneWordBtn.onclick = function() { checkAnswers('oneWord'); };
      }
      function checkAnswers(type) {
        // ...existing code...
      }
      function renderLongAnswer() {
        const laDiv = document.getElementById('long-answer-content');
        if (!chapterData || !chapterData.longAnswerQuestions) {
          laDiv.innerHTML = '<em>No long answer questions available.</em>';
          return;
        }
        let html = chapterData.longAnswerQuestions.map((s, idx) => {
          let answerBtns = '';
          let answerBlocks = '';
          const answerTypes = [
            { key: 'answer50To75Words', label: 'Show 50-75 Words Answer' },
            { key: 'answer150Words', label: 'Show 150 Words Answer' },
            { key: 'answer200Words', label: 'Show 200 Words Answer' }
          ];
          answerTypes.forEach(type => {
            if (s[type.key]) {
              const btnId = `show-${type.key}-${idx}`;
              const ansId = `ans-${type.key}-${idx}`;
              answerBtns += `<button id="${btnId}" class="ml-2 mb-2 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs" onclick="document.getElementById('${ansId}').classList.toggle('hidden')">${type.label}</button>`;
              answerBlocks += `<div id="${ansId}" class="hidden bg-blue-50 border border-blue-200 rounded p-2 mt-1 text-sm">${s[type.key]}</div>`;
            }
          });
          const title = (s.title && s.title !== 'undefined') ? s.title : '';
          const text = (s.text && s.text !== 'undefined') ? s.text : '';
          return `<div class="mb-6"><strong>Q${idx + 1}. ${title}:</strong> ${text}<br>${answerBtns}${answerBlocks}</div>`;
        }).join('');
        laDiv.innerHTML = html;
      // End of renderLongAnswer
      }
      function playLongAnswer() {
        // ...existing code...
      }
      function pauseLongAnswer() {
        // ...existing code...
      }
      function stopLongAnswer() {
        // ...existing code...
      }
      function renderNumericalQuestions() {
        // ...existing code...
      }
    </script>
</body>
</html>
